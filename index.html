<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>靈韻美學 - 讓靈魂聞見美，讓信仰成為感官的祝福</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.8/dist/chart.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=Lato:wght@300;400;700&display=swap" rel="stylesheet">
  
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            cream: '#F8F5F0',
            gold: '#D4AF37',
            lavender: '#9F86C0',
            olive: '#556B2F',
            rose: '#F8C4C4',
          },
          fontFamily: {
            serif: ['Playfair Display', 'serif'],
            sans: ['Lato', 'sans-serif']
          }
        }
      }
    }
  </script>
  
  <style type="text/tailwindcss">
    @layer utilities {
      .text-shadow-lg {
        text-shadow: 2px 2px 5px rgba(0, 0, 0, 0.5);
      }
      .card-hover:hover {
        transform: translateY(-10px);
        box-shadow: 0 15px 30px rgba(0, 0, 0, 0.1);
      }
    }
    /* Modal 樣式 */
    .modal-overlay {
      transition: opacity 0.3s ease;
    }
    .modal-container {
      transition: transform 0.3s ease;
    }
  </style>
</head>

<body class="bg-cream font-sans text-gray-800 overflow-x-hidden">
  <header class="fixed w-full top-0 z-50 transition-all duration-300" id="navbar">
    <nav class="bg-cream/90 backdrop-blur-md py-4 px-6 md:px-12 shadow-sm">
      <div class="container mx-auto flex justify-between items-center">
        <a href="#" class="flex items-center space-x-2">
          <div class="w-10 h-10 rounded-full bg-gold flex items-center justify-center">
            <span class="text-white font-serif font-bold text-xl">靈</span>
          </div>
          <span class="font-serif font-bold text-xl md:text-2xl text-gray-800">靈韻美學</span>
        </a>
        
        <div class="hidden md:flex items-center space-x-8">
          <a href="#" class="font-medium hover:text-gold transition-colors duration-200">首頁</a>
          <a href="#shop" class="font-medium hover:text-gold transition-colors duration-200">靈性產品</a>
          <a href="#contact" class="font-medium hover:text-gold transition-colors duration-200">聯絡我們</a>
          <button id="cart-button" class="relative text-gray-800 hover:text-gold transition-colors">
            <i class="fa fa-shopping-cart text-2xl"></i>
            <span id="cart-item-count" class="absolute -top-2 -right-2 bg-rose text-white text-xs font-bold rounded-full w-5 h-5 flex items-center justify-center">0</span>
          </button>
        </div>
        
        <button id="menu-toggle" class="md:hidden text-gray-800 focus:outline-none">
          <i class="fa fa-bars text-xl"></i>
        </button>
      </div>
    </nav>
  </header>

  <main>
    <section class="min-h-screen pt-24 relative overflow-hidden">
        <div class="relative h-[70vh] flex items-center justify-center overflow-hidden">
            <img src="https://picsum.photos/id/1060/1920/1080" alt="靈性之美" class="w-full h-full object-cover">
            <div class="absolute inset-0 bg-black/50 z-10"></div>
            <div class="absolute inset-0 z-20 flex flex-col justify-center items-center text-center px-6">
                <h2 class="text-white font-serif text-3xl md:text-5xl lg:text-6xl font-bold mb-4 text-shadow-lg">讓信仰成為感官的祝福</h2>
                <p class="text-white/90 text-lg md:text-xl max-w-2xl mb-8">在色彩、香氣、文字與靜默中，重新覺醒你與神的連結。</p>
                <a href="#shop" class="bg-gold hover:bg-gold/90 text-white px-8 py-3 rounded-full font-medium transition-all duration-300 shadow-lg">
                開始選購
                </a>
            </div>
        </div>
    </section>
    
    <section id="shop" class="py-20 bg-gradient-to-b from-rose/10 to-cream">
      <div class="container mx-auto px-6">
        <div class="text-center mb-16">
          <h2 class="font-serif text-3xl md:text-4xl font-bold mb-6 text-gray-800">靈性產品</h2>
          <p class="text-lg text-gray-600 max-w-3xl mx-auto">
            香氣、色彩、文字與創作，每一件作品都承載著祝福。
          </p>
        </div>
        
        <div id="product-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8">
          </div>
      </div>
    </section>

    <section id="contact" class="py-20">
       <div class="container mx-auto px-6 text-center">
            <h2 class="font-serif text-3xl md:text-4xl font-bold mb-6 text-gray-800">與我們連結</h2>
            <p class="text-lg text-gray-600 max-w-3xl mx-auto">
                若有任何問題，歡迎隨時與我們聯繫。<br>
                Email: info@lingyun-aesthetics.com | 電話: +886-2-1234-5678
            </p>
       </div>
    </section>
  </main>
  
  <div id="order-modal" class="modal-overlay fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4 opacity-0 pointer-events-none">
    <div class="modal-container bg-white rounded-lg shadow-xl w-full max-w-3xl max-h-[90vh] overflow-y-auto transform scale-95">
      <div class="sticky top-0 bg-white border-b px-6 py-4 flex justify-between items-center z-10">
        <h2 class="text-2xl font-serif font-bold text-gray-800">您的訂單</h2>
        <button id="close-modal-button" class="text-gray-500 hover:text-gray-800 text-2xl">&times;</button>
      </div>

      <div class="p-6">
        <div id="cart-view">
          <div id="cart-items-container" class="mb-6 space-y-4">
            </div>
          <div class="border-t pt-4 text-right">
            <p class="text-lg">小計: <span id="subtotal">NT$ 0</span></p>
            <p class="text-lg">營業稅 (5%): <span id="tax">NT$ 0</span></p>
            <p class="text-2xl font-bold">總計: <span id="total">NT$ 0</span></p>
          </div>
          <div class="mt-8 text-center">
            <button id="to-checkout-button" class="w-full md:w-auto bg-gold text-white px-8 py-3 rounded-lg font-medium hover:bg-gold/90 transition-colors disabled:bg-gray-400">
              填寫訂購資訊
            </button>
          </div>
        </div>

        <div id="checkout-view" class="hidden">
          <h3 class="font-serif text-xl font-bold mb-6">收件人資訊</h3>
          <form id="customer-form" class="space-y-4">
            <div>
              <label for="customer-name" class="block text-sm font-medium text-gray-700">真實姓名</label>
              <input type="text" id="customer-name" name="name" required class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-gold focus:border-gold">
            </div>
            <div>
              <label for="customer-phone" class="block text-sm font-medium text-gray-700">聯絡電話</label>
              <input type="tel" id="customer-phone" name="phone" required class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-gold focus:border-gold">
            </div>
            <div>
              <label for="customer-address" class="block text-sm font-medium text-gray-700">收件地址</label>
              <input type="text" id="customer-address" name="address" required class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-gold focus:border-gold">
            </div>
            <div class="mt-8 flex flex-col md:flex-row gap-4">
              <button type="button" id="back-to-cart-button" class="w-full md:w-auto bg-gray-200 text-gray-800 px-8 py-3 rounded-lg font-medium hover:bg-gray-300">
                返回修改訂單
              </button>
              <button type="submit" class="w-full md:w-auto bg-gold text-white px-8 py-3 rounded-lg font-medium hover:bg-gold/90">
                確認訂單並產生訂單資訊
              </button>
            </div>
          </form>
        </div>

        <div id="confirmation-view" class="hidden text-center">
          <h3 class="font-serif text-xl font-bold mb-4 text-olive">感謝您的訂購！</h3>
          <p class="text-gray-600 mb-6">您的訂單已成功建立，請下載訂單 PDF 存檔，並依下列資訊完成匯款。</p>
          <div class="bg-gold/10 p-6 rounded-lg border-l-4 border-gold text-left mb-6">
            <h4 class="font-bold text-lg mb-2">匯款資訊</h4>
            <p><strong>銀行：</strong> 元大銀行 南屯分行</p>
            <p><strong>帳號：</strong> 00168266574918</p>
            <p class="mt-4">完成匯款後，請掃描下方 QR Code 加入我們的官方帳號，並告知我們您的「訂單編號」及「匯款帳號末四碼」，我們將盡快為您處理出貨事宜。</p>
          </div>
          <div class="flex flex-col items-center">
            <img id="qr-code-placeholder" src="https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=https://YOUR_LINE_OA_LINK" alt="官方帳號 QR Code" class="w-36 h-36 mb-2">
            <p class="text-sm text-gray-500">掃描加入官方帳號</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div id="pdf-content" class="hidden"></div>


  <script>
    document.addEventListener('DOMContentLoaded', () => {
      /**************************************************/
      /***** 1. 產品資料庫：請在這裡管理您的產品 *****/
      /**************************************************/
      const products = [
        // 【重要】請務必將下面的 image 路徑，換成您在 images 資料夾中真實的圖片檔名
        {
          id: 'prod001',
          name: '乳香靜思者香氛',
          image: 'images/prod001.jpg', // 範例路徑，請替換
          description: '專為需要深度靜思與祈禱的靈性探索者設計。溫暖、神聖的氣息，幫助你進入安靜的內在空間，與神相遇。',
          specs: '容量: 100ml | 成分: 天然精油、酒精',
          price: 1200,
        },
        {
          id: 'prod002',
          name: '玫瑰關懷者香氛',
          image: 'images/prod002.jpg', // 範例路徑，請替換
          description: '溫柔的玫瑰香氣，象徵神的愛與關懷。適合在需要安慰與療癒的時刻使用，感受被溫柔擁抱的平靜。',
          specs: '容量: 100ml | 成分: 天然精油、酒精',
          price: 1200,
        },
        {
          id: 'prod003',
          name: '柑橘創造者香氛',
          image: 'images/prod003.jpg', // 範例路徑，請替換
          description: '充滿活力的柑橘調，激發創造力與喜樂。在靈性創作或迎接新的一天時使用，帶來陽光般的能量。',
          specs: '容量: 100ml | 成分: 天然精油、酒精',
          price: 1100,
        },
        {
          id: 'prod004',
          name: '靈性入門包',
          image: 'images/prod004.jpg', // 範例路徑，請替換
          description: '包含三款經典香氛小樣、靈修筆記本與經文卡。是開始您的靈性美學旅程的最佳選擇。',
          specs: '內容: 香氛 10ml x3, 筆記本 x1, 經文卡 x5',
          price: 2800,
        },
      ];

      /**************************************************/
      /***** 2. 系統設定 *****/
      /**************************************************/
      const TAX_RATE = 0.05;
      const QR_CODE_BASE64 = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII='; // 請記得換成您自己的 QR Code Base64
      let cart = [];

      /**************************************************/
      /***** 3. 核心功能函式 (無需修改) *****/
      /**************************************************/

      // 渲染產品
      const productListContainer = document.getElementById('product-list');
      function renderProducts() {
        if (!productListContainer) return; // 安全檢查
        productListContainer.innerHTML = '';
        products.forEach(product => {
          const productHTML = `
            <div class="bg-white rounded-xl shadow-lg overflow-hidden flex flex-col transition duration-300 card-hover">
              <div class="h-64 overflow-hidden">
                <img src="${product.image}" alt="${product.name}" class="w-full h-full object-cover">
              </div>
              <div class="p-6 flex flex-col flex-grow">
                <h3 class="font-serif text-xl font-bold mb-2">${product.name}</h3>
                <p class="text-gray-500 text-sm mb-1">編號: ${product.id}</p>
                <p class="text-gray-500 text-sm mb-3">規格: ${product.specs}</p>
                <p class="text-gray-600 mb-4 flex-grow">${product.description}</p>
                <div class="flex justify-between items-center mt-auto pt-4 border-t">
                  <span class="text-gold font-bold text-lg">NT$ ${product.price.toLocaleString()}</span>
                  <button onclick="addToCart('${product.id}')" class="bg-gold hover:bg-gold/90 text-white px-4 py-2 rounded-lg font-medium transition-all duration-300">
                    選購
                  </button>
                </div>
              </div>
            </div>`;
          productListContainer.innerHTML += productHTML;
        });
      }

      // 加入購物車
      window.addToCart = (productId) => {
        const item = cart.find(i => i.id === productId);
        if (item) item.quantity++; else cart.push({ id: productId, quantity: 1 });
        updateCart();
        showNotification(`${products.find(p => p.id === productId).name} 已加入訂單！`);
      }

      // 提示訊息
      function showNotification(message) {
        const el = document.createElement('div');
        el.className = 'fixed top-24 right-5 bg-olive text-white px-6 py-3 rounded-lg shadow-lg transition-transform transform translate-x-full';
        el.innerText = message;
        document.body.appendChild(el);
        setTimeout(() => el.style.transform = 'translateX(0)', 10);
        setTimeout(() => {
          el.style.transform = 'translateX(calc(100% + 20px))';
          setTimeout(() => el.remove(), 300);
        }, 3000);
      }

      // 更新購物車
      function updateCart() {
        const container = document.getElementById('cart-items-container');
        if (!container) return; // 安全檢查
        container.innerHTML = '';
        let subtotal = 0;
        if (cart.length === 0) {
          container.innerHTML = '<p class="text-center text-gray-500">您的訂單是空的。</p>';
          document.getElementById('to-checkout-button').disabled = true;
        } else {
          document.getElementById('to-checkout-button').disabled = false;
          cart.forEach(item => {
            const product = products.find(p => p.id === item.id);
            if (!product) return;
            const itemTotal = product.price * item.quantity;
            subtotal += itemTotal;
            container.innerHTML += `
              <div class="flex items-center gap-4 border-b pb-4">
                <img src="${product.image}" alt="${product.name}" class="w-16 h-16 object-cover rounded-md">
                <div class="flex-grow">
                  <p class="font-bold">${product.name}</p>
                  <p class="text-sm text-gray-500">NT$ ${product.price.toLocaleString()}</p>
                </div>
                <div class="flex items-center gap-2">
                  <button onclick="updateQuantity('${item.id}', -1)" class="w-7 h-7 bg-gray-200 rounded-full font-bold">-</button>
                  <span>${item.quantity}</span>
                  <button onclick="updateQuantity('${item.id}', 1)" class="w-7 h-7 bg-gray-200 rounded-full font-bold">+</button>
                </div>
                <p class="w-24 text-right font-medium">NT$ ${itemTotal.toLocaleString()}</p>
                <button onclick="removeFromCart('${item.id}')" class="text-red-500 hover:text-red-700">&times;</button>
              </div>`;
          });
        }
        const tax = subtotal * TAX_RATE;
        document.getElementById('subtotal').innerText = `NT$ ${Math.round(subtotal).toLocaleString()}`;
        document.getElementById('tax').innerText = `NT$ ${Math.round(tax).toLocaleString()}`;
        document.getElementById('total').innerText = `NT$ ${Math.round(subtotal + tax).toLocaleString()}`;
        document.getElementById('cart-item-count').innerText = cart.reduce((sum, item) => sum + item.quantity, 0);
      }

      // 更新數量
      window.updateQuantity = (id, change) => {
        const item = cart.find(i => i.id === id);
        if (item) {
          item.quantity += change;
          if (item.quantity <= 0) removeFromCart(id); else updateCart();
        }
      }

      // 移除商品
      window.removeFromCart = (id) => {
        cart = cart.filter(i => i.id !== id);
        updateCart();
      }

      // ===============================================
      // ===== 最終版 PDF 產生函式 =====
      // ===============================================
      async function generateOrderPDF(customerData, orderNumber) {
        const submitButton = document.querySelector('#customer-form button[type="submit"]');
        submitButton.disabled = true;
        submitButton.innerText = '訂單產生中...';

        const { jsPDF } = window.jspdf;
        const pdfContent = document.getElementById('pdf-content');
        
        let itemsHTML = '';
        let subtotal = cart.reduce((sum, item) => {
            const product = products.find(p => p.id === item.id);
            if (!product) return sum;
            itemsHTML += `<tr>
                <td style="padding: 8px; border-bottom: 1px solid #ddd;">${product.name} (${product.id})</td>
                <td style="padding: 8px; border-bottom: 1px solid #ddd; text-align: right;">${item.quantity}</td>
                <td style="padding: 8px; border-bottom: 1px solid #ddd; text-align: right;">${product.price.toLocaleString()}</td>
                <td style="padding: 8px; border-bottom: 1px solid #ddd; text-align: right;">${(product.price * item.quantity).toLocaleString()}</td>
            </tr>`;
            return sum + product.price * item.quantity;
        }, 0);
        const tax = subtotal * TAX_RATE;
        const total = subtotal + tax;
        
        pdfContent.innerHTML = `
          <div style="font-family: sans-serif; padding: 20px; width: 700px; background: white;">
            <h1 style="font-size: 24px; color: #556B2F; border-bottom: 2px solid #D4AF37; padding-bottom: 10px;">靈韻美學 訂單資訊</h1>
            <p><strong>訂單編號:</strong> ${orderNumber}</p>
            <p><strong>訂購日期:</strong> ${new Date().toLocaleDateString('zh-TW')}</p>
            <h2 style="font-size: 18px; margin-top: 20px;">客戶資訊</h2>
            <p><strong>姓名:</strong> ${customerData.name}</p>
            <p><strong>電話:</strong> ${customerData.phone}</p>
            <p><strong>地址:</strong> ${customerData.address}</p>
            <h2 style="font-size: 18px; margin-top: 20px;">訂單明細</h2>
            <table style="width: 100%; border-collapse: collapse;">
                <thead><tr>
                    <th style="text-align: left; padding: 8px; border-bottom: 2px solid #333;">品名</th>
                    <th style="text-align: right; padding: 8px; border-bottom: 2px solid #333;">数量</th>
                    <th style="text-align: right; padding: 8px; border-bottom: 2px solid #333;">單價</th>
                    <th style="text-align: right; padding: 8px; border-bottom: 2px solid #333;">小計</th>
                </tr></thead>
                <tbody>${itemsHTML}</tbody>
            </table>
            <div style="text-align: right; margin-top: 20px;">
                <p><strong>小計:</strong> NT$ ${Math.round(subtotal).toLocaleString()}</p>
                <p><strong>營業稅 (5%):</strong> NT$ ${Math.round(tax).toLocaleString()}</p>
                <p style="font-size: 20px; font-weight: bold;"><strong>總計:</strong> NT$ ${Math.round(total).toLocaleString()}</p>
            </div>
            <div style="display: flex; justify-content: space-between; align-items: flex-end; margin-top: 30px; padding-top: 15px; border-top: 1px solid #eee;">
                <div style="padding: 15px; background-color: #f7f3e9; border-left: 4px solid #D4AF37; width: 70%;">
                    <h2 style="font-size: 18px;">匯款資訊 & 後續步驟</h2>
                    <p><strong>銀行：</strong> 元大銀行 南屯分行</p>
                    <p><strong>帳號：</strong> 00168266574918</p>
                    <p style="margin-top: 10px;">完成匯款後，請加入我們的官方帳號 (右側QR Code)，並告知您的「訂單編號」及「匯款帳號末四碼」。</p>
                </div>
                <img src="${QR_CODE_BASE64}" style="width: 100px; height: 100px;">
            </div>
          </div>`;
        
        try {
          const canvas = await html2canvas(pdfContent.firstElementChild, { scale: 2 });
          const imgData = canvas.toDataURL('image/png');
          const pdf = new jsPDF({ orientation: 'p', unit: 'px', format: [canvas.width, canvas.height] });
          pdf.addImage(imgData, 'PNG', 0, 0, canvas.width, canvas.height);
          pdf.save(`lingyun-order-${orderNumber}.pdf`);

          document.getElementById('checkout-view').classList.add('hidden');
          document.getElementById('confirmation-view').classList.remove('hidden');
          cart = [];
          updateCart();
        } catch (error) {
          console.error("PDF 產生失敗:", error);
          alert(`抱歉，訂單 PDF 產生失敗，請聯繫我們。錯誤訊息: ${error.message}`);
        } finally {
          submitButton.disabled = false;
          submitButton.innerText = '確認訂單並產生訂單資訊';
        }
      }

      /**************************************************/
      /***** 4. 事件監聽與流程控制 (無需修改) *****/
      /**************************************************/
      const modal = document.getElementById('order-modal');
      const cartButton = document.getElementById('cart-button');
      const closeModalButton = document.getElementById('close-modal-button');
      const toCheckoutButton = document.getElementById('to-checkout-button');
      const backToCartButton = document.getElementById('back-to-cart-button');
      const customerForm = document.getElementById('customer-form');
      
      const cartView = document.getElementById('cart-view');
      const checkoutView = document.getElementById('checkout-view');
      const confirmationView = document.getElementById('confirmation-view');

      document.getElementById('qr-code-placeholder').src = QR_CODE_BASE64;

      const openModal = () => {
        updateCart();
        modal.classList.remove('opacity-0', 'pointer-events-none');
        modal.querySelector('.modal-container').classList.remove('scale-95');
      };
      const closeModal = () => {
        modal.classList.add('opacity-0', 'pointer-events-none');
        modal.querySelector('.modal-container').classList.add('scale-95');
        setTimeout(() => {
          cartView.classList.remove('hidden');
          checkoutView.classList.add('hidden');
          confirmationView.classList.add('hidden');
        }, 300);
      };

      cartButton.addEventListener('click', openModal);
      closeModalButton.addEventListener('click', closeModal);
      modal.addEventListener('click', (e) => {
        if (e.target === modal) closeModal();
      });

      toCheckoutButton.addEventListener('click', () => {
        cartView.classList.add('hidden');
        checkoutView.classList.remove('hidden');
      });
      backToCartButton.addEventListener('click', () => {
        checkoutView.classList.add('hidden');
        cartView.classList.remove('hidden');
      });

      customerForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        const customerData = Object.fromEntries(new FormData(customerForm).entries());
        const orderNumber = `LY${new Date().getTime()}`;
        await generateOrderPDF(customerData, orderNumber);
      });

      renderProducts();
    });
  </script>
</body>
</html>